<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>环境准备 | qingyu-docs</title>
    <meta name="description" content="项目总结">
    <link rel="stylesheet" href="/yunshan-qingyu-docs/assets/style.c3210e46.css">
    <link rel="modulepreload" href="/yunshan-qingyu-docs/assets/app.2f45899f.js">
    <link rel="modulepreload" href="/yunshan-qingyu-docs/assets/learning_index.md.f620b335.lean.js">
    
    <meta name="twitter:title" content="环境准备 | qingyu-docs">
  <meta property="og:title" content="环境准备 | qingyu-docs">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/yunshan-qingyu-docs/" aria-label="qingyu-docs, back to home" data-v-675d8756 data-v-cc01ef16><!----> qingyu-docs</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/yunshan-qingyu-docs/learning/" data-v-b8818f8c>项目总结 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/yunshan-qingyu-docs/learning/" data-v-b8818f8c>项目总结 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item"></p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/yunshan-qingyu-docs/learning/">总结</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#环境准备">环境准备</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#界面逻辑">界面逻辑</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#全局分析">全局分析</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#热点聚集">热点聚集</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#每周报表-专题分析">每周报表 &amp; 专题分析</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#信息检索">信息检索</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#composition-api">Composition Api</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#工具函数">工具函数</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#axios">axios</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#storage">storage</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#usepage">usePage</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#usecurrentinstance">useCurrentInstance</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#useecharts">useEcharts</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#跨域问题">跨域问题</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#后台处理-反向代理">后台处理(反向代理)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#前端处理-正向代理">前端处理(正向代理)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#开发环境-mock">开发环境 mock</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#应用部署">应用部署</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#功能亮点">功能亮点</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#输入框级联">输入框级联</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#补充知识">补充知识</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#object-的序列化">Object 的序列化</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#类型判断">类型判断</a><!----></li></ul></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h2 id="环境准备" tabindex="-1">环境准备 <a class="header-anchor" href="#环境准备" aria-hidden="true">#</a></h2><p>Vue3 + Vite + Typescript</p><p>node 版本在 14 版本以上</p><p><a href="https://zhuanlan.zhihu.com/p/421493074" target="_blank" rel="noopener noreferrer">git bash 配置作为默认控制台</a></p><h2 id="界面逻辑" tabindex="-1">界面逻辑 <a class="header-anchor" href="#界面逻辑" aria-hidden="true">#</a></h2><p><img src="/yunshan-qingyu-docs/framework.png" alt=""></p><h3 id="全局分析" tabindex="-1">全局分析 <a class="header-anchor" href="#全局分析" aria-hidden="true">#</a></h3><p><img src="/yunshan-qingyu-docs/hot-words.png" alt=""></p><p><img src="/yunshan-qingyu-docs/active-user.png" alt=""></p><p>ℹ️ 全局分析里面有很多个模块，每个模块的模版，数据，样式其实都是隔离的，所以我们倾向于是把每一个模块都抽象为是一个组件，曾经在面试的时候有面试官问过我，组件是什么？为什么我们需要组件？其实我没有回答得很好，我觉得组件其实是一个模块的拆分，里面的数据可能依赖于外部传递，也可能内部有自己实现的逻辑。<a href="https://zhuanlan.zhihu.com/p/33999571" target="_blank" rel="noopener noreferrer">知乎</a></p><h4 id="主要逻辑" tabindex="-1">主要逻辑 <a class="header-anchor" href="#主要逻辑" aria-hidden="true">#</a></h4><ul><li>全局分析的组件主要在 components/common 下，每一个文件夹内部又抽取了一个 item.vue 和 index.vue，因为其实像上面活跃用户它是由多个元素的。</li></ul><div class="language-html"><pre><code><span class="token comment">&lt;!-- 对应 item.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card--body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data.logo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ data.user }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>blogs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发帖数 <span class="token entity named-entity" title=" ">&amp;nbsp;</span>{{ data.creates }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>ts<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ActiveCardItem&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Object
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ellipsis <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      ellipsis
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html"><pre><code><span class="token comment">&lt;!-- index.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>active_user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>model--title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>活跃用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>card-item</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in activeUsers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>在 index.vue 通过获取数据然后通过 v-for 渲染 item.vue，这样的好处在于数据获取的逻辑就隔离在了 index.vue， 视图渲染逻辑就隔离在 item.vue 两者通过组件通信的方式进行信息传递，逻辑可能会更加清晰一些，当然其实放在一起也是没问题的，每个人都有每个人不同的组织思路，其实最后能够完成任务怎么实现都是可以的。</p><p>❗ 在我们写好了这些业务组件以后，怎么样把它放到全局分析上去呢？我们需要考虑一个问题：数据获取的逻辑到底是放在每个组件里面还是说统一由父组件传递进去？</p><div class="language-html"><pre><code><span class="token comment">&lt;!-- 全局分析 index.vue --&gt;</span>      
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-row</span> <span class="token attr-name">:gutter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 热点词汇 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wordcloud</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:wordcloud-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wordCloudData<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 活跃用户 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active-user</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:active-users</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>activeUserData<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 热点新闻 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>daily-hot</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:hot-news</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hotNews<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 博主分析 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blog-analyse</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:ranking</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rankingData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:school-pie-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schoolPieData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:school-table-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schoolTableData<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-row</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>其实两种方式都是可以的，只是说后面处理的方式不一样，那我两种方法都说下：</p><ol><li>统一由父组件传递进去</li></ol><div class="language-ts"><pre><code>  <span class="token keyword">const</span> <span class="token function-variable function">initData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getHotNews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getWordCloud</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">useBloggerAnalyse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>dataLists <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      activeUserData<span class="token punctuation">.</span>value <span class="token operator">=</span> dataLists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 更新活跃用户数据</span>
      hotNews<span class="token punctuation">.</span>value <span class="token operator">=</span> dataLists<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// 更新热点新闻数据</span>
      wordCloudData<span class="token punctuation">.</span>value <span class="token operator">=</span> dataLists<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">// 更新词云数据</span>
      rankingData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>dataLists<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      schoolPieData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>dataLists<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      schoolTableData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>dataLists<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        isShow<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>使用 initData 函数获取所有组件的数据，然后像上面代码中通过 v-bind 的方式去绑定数据进行父子组件通信。我在项目中使用的是这样方式，原因应该有两个：</p><p>😉 第一：可以控制组件什么时候显示，也就是说我可以通过在每个组件上设置一个 isShow 的值，只有当数据全部加载完成以后才进行视图的展示，否则就显示加载动画。(主要)</p><p>😉 第二：如果需要根据时间/ 关键字获取数据的话可以统一在 initData 内部加 (次要)</p><ol start="2"><li>每个子组件单独获取数据</li></ol><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-row</span> <span class="token attr-name">:gutter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 热点词汇 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wordcloud</span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 活跃用户 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active-user</span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 热点新闻 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>daily-hot</span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 博主分析 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blog-analyse</span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-row</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对应的 HTML 代码应该就是这样的，然后在 wordcloud 组件里面获取 wordcloud 数据，在 active-user 里面获取 active-user 数据.....，至于说怎么根据时间 / 关键字去更新数据的话可以通过 <a href="https://www.javascriptc.com/vue3js/api/special-attributes.html#ref" target="_blank" rel="noopener noreferrer">ref</a> 引用到子组件，然后调用子组件的方式顺便传递数据。</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wordcloud</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wordcloud<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active-user</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>activeUser<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
export default defineComponent({
  setup() {
      const wordcloud = ref()
      const activeUser = ref()
      ...
      const onGetData = (type, time) =&gt; {
          wordcloud.value.getData(type, time)
          activeUser.value.getData(type, time)
          ....
      }
  }  
})
&lt;/&gt;
</code></pre></div><p>ℹ️ 这样也是可以的，但是我觉得有一个最大的缺点就是父组件难以控制子组件是否显示。比如说 wordcloud 的数据很快就加载完了，但是 activeUser 的数据还是没有的，那么此时页面就会有个空白的情况，我们可以给每个组件都设定一个 loading 的逻辑也是可以的，但是相对来说就没有那么方便吧。但是奈何这种方式其实更容易理解，所以实际中使用哪一种其实也没有特别限制，根据需求去切换其实就好了。</p><h3 id="热点聚集" tabindex="-1">热点聚集 <a class="header-anchor" href="#热点聚集" aria-hidden="true">#</a></h3><p><img src="/yunshan-qingyu-docs/hoT-news.png" alt=""></p><p>选择“平台”和“时间” 都可以实现数据的切换，那是怎么做的呢？</p><div class="language-html"><pre><code>    <span class="token comment">&lt;!-- 时间选择 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-select</span> <span class="token attr-name"><span class="token namespace">v-model:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>timeslot<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:options</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>option<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onTimeChange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>select<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-select</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-tabs</span> <span class="token attr-name"><span class="token namespace">v-model:</span>activeKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>platform<span class="token punctuation">&quot;</span></span> <span class="token attr-name">animated</span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onPlatformChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-tab-pane</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tab</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>知乎<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>card-item</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in cardData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onPageRedirct(item.id)<span class="token punctuation">&quot;</span></span>   <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-tab-pane</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-tabs</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts"><pre><code>  <span class="token keyword">const</span> <span class="token function-variable function">onTimeChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;on time change&#39;</span><span class="token punctuation">)</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">onPlatformChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;platform change&#39;</span><span class="token punctuation">)</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>time<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span><span class="token operator">|</span><span class="token keyword">null</span><span class="token punctuation">,</span> platform<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span><span class="token operator">|</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> platform<span class="token punctuation">)</span>
    cardData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// 重新进行数据的赋值</span>
    cardData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">XRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">.</span>hotSpot<span class="token punctuation">,</span> param<span class="token operator">:</span> <span class="token punctuation">{</span> time<span class="token punctuation">,</span> platform <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="主要逻辑-1" tabindex="-1">主要逻辑 <a class="header-anchor" href="#主要逻辑-1" aria-hidden="true">#</a></h4><p>ℹ️ 本质上是通过监听 select 选择框和 tabs 的触发事件，也就是上面的 onTimeChange 和 onPlatfromChange(ant-desigin-vue 提供的 change 事件)。每次触发的时候将对应的参数传递到获取数据的函数那里重新请求数据。</p><h3 id="每周报表-专题分析" tabindex="-1">每周报表 &amp; 专题分析 <a class="header-anchor" href="#每周报表-专题分析" aria-hidden="true">#</a></h3><blockquote><p>两个模块放在一起讲是因为它们其实是类似的，因为其实都是表格然后基于不同的条件进行数据的筛选</p></blockquote><img src="/yunshan-qingyu-docs/weekly-report.png" alt="image-20220520151300897" style="zoom:67%;"><h4 id="主要的逻辑" tabindex="-1">主要的逻辑 <a class="header-anchor" href="#主要的逻辑" aria-hidden="true">#</a></h4><ol><li>点击查看的时候传递时间序列(开始事件-结束时间)给后台，然后后台根据时间检索对应的数据返回给我们。具体的数据获取逻辑和全局分析里面是类似的。</li></ol><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">initData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">startTime<span class="token punctuation">,</span> endTime</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">getUsers</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getHotNews</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getWordCloud</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">useBloggerAnalyse</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">dataLists</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      activeUserData<span class="token punctuation">.</span>value <span class="token operator">=</span> dataLists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 更新活跃用户数据</span>
      hotNews<span class="token punctuation">.</span>value <span class="token operator">=</span> dataLists<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// 更新热点新闻数据</span>
      wordCloudData<span class="token punctuation">.</span>value <span class="token operator">=</span> dataLists<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">// 更新词云数据</span>
      rankingData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>dataLists<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      schoolPieData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>dataLists<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      schoolTableData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>dataLists<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        isShow<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>🔑 其实 initData 这个函数就是全局分析里面的那个 initData，只不过我们传递了开始时间和结束时间两个参数进去而已，所以这也是为什么在代码里面把这个 initData 函数放到 controller 里面的原因，因为这个是可以复用的。</p><p>😉 那对于专题分析来说，传递进去的数据可能就是开始时间，结束时间，关键字，initData 依然可以不变呀！</p><p>❗ 那如果模块不一样了怎么办，那就简单了，重新写个和 initData 类似的函数不就可以了嘛。</p><ol start="2"><li>新建报表 / 新建分析</li></ol><div class="language-js"><pre><code><span class="token keyword">const</span> reportState <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">setConfirm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把 reportState 的数据传递给后台即可</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="信息检索" tabindex="-1">信息检索 <a class="header-anchor" href="#信息检索" aria-hidden="true">#</a></h3><h2 id="composition-api" tabindex="-1">Composition Api <a class="header-anchor" href="#composition-api" aria-hidden="true">#</a></h2><blockquote><p>controller 里面的 .ts 文件。目的也是为了逻辑可复用和抽离。</p></blockquote><div class="language-js"><pre><code><span class="token comment">// 抽取热点聚集平台切换的逻辑到 src/controllers/hotspot/useCard.ts</span>
<span class="token keyword">const</span> <span class="token function-variable function">onTimeChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;on time change&#39;</span><span class="token punctuation">)</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* 平台序列 */</span>
  <span class="token keyword">const</span> platform <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onPlatformChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;platform change&#39;</span><span class="token punctuation">)</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* 时间切换 &amp; 平台切换 双重处理 */</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">time<span class="token operator">?</span><span class="token operator">:</span>string<span class="token operator">|</span><span class="token keyword">null</span><span class="token punctuation">,</span> platform<span class="token operator">?</span><span class="token operator">:</span>string<span class="token operator">|</span><span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> platform<span class="token punctuation">)</span>
    cardData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    cardData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">XRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">.</span>hotSpot<span class="token punctuation">,</span> <span class="token literal-property property">param</span><span class="token operator">:</span> <span class="token punctuation">{</span> time<span class="token punctuation">,</span> platform <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>:star 一般 composition api 抽取出来的函数以 use + &#39;xxxx&#39; 来命名表示是内部抽取逻辑。</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useCard</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useOverview</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">...</span>

<span class="token comment">// 在组件引用的时候</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useOverview</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre></div><h2 id="工具函数" tabindex="-1">工具函数 <a class="header-anchor" href="#工具函数" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>其实也就是 utils 里面的函数，这些函数写好一次以后是可以直接搬到别的项目里面用的，这也是为什么它们叫工具函数的原因。</p></div><h3 id="axios" tabindex="-1">axios <a class="header-anchor" href="#axios" aria-hidden="true">#</a></h3><blockquote><p>请求工具函数，封装好了以后导出一个函数实例，可以通过传递不同的参数来实现不同的网络请求，封装的目的是为了使得函数整体的复用性更强。</p></blockquote><div class="language-js"><pre><code><span class="token comment">// axios.ts </span>
<span class="token keyword">import</span> type <span class="token punctuation">{</span> AxiosInstance<span class="token punctuation">,</span> AxiosRequestConfig<span class="token punctuation">,</span> AxiosResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">HEADERS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./headers&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">http</span><span class="token operator">:</span> AxiosInstance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">/* baseURL: import.<wbr>meta.env.MODE === &#39;development&#39;
    ? &#39;/prod&#39;
    : &#39;/prod&#39; */</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token constant">HEADERS</span><span class="token punctuation">.</span><span class="token constant">JSON</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* 请求拦截配置(针对当前项目一般是 application/json) */</span>
http<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">config</span><span class="token operator">:</span> AxiosRequestConfig</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 添加 token 传递和验证</span>
  <span class="token keyword">return</span> config
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* 响应拦截配置(针对当前项目存在一些不同的 responseType) */</span>
http<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">response</span><span class="token operator">:</span> AxiosResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 拦截响应信息进行相应的重定向处理</span>
  <span class="token comment">// console.log(response);</span>
  <span class="token comment">// return response.data.data</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>res<span class="token punctuation">.</span>data
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><ul><li>上面其实主要就是创建了一个 axios 实例。然后对实例进行初始化的配置，比如一个 baseURL，拦截器等。</li></ul><div class="language-ts"><pre><code><span class="token comment">// src/utils/axios/index.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">XRequest</span> <span class="token punctuation">(</span>properties<span class="token operator">:</span> RequestParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> params<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span> param<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> options <span class="token punctuation">}</span> <span class="token operator">=</span> properties

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function-variable function">resolve</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token operator">?.</span>isToken<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 配置 token</span>
      http<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer 	</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">||</span> <span class="token string">&#39;&#39;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data <span class="token operator">=</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> param <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">&#39;delete&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data <span class="token operator">=</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> param <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">&#39;post&#39;</span> <span class="token operator">||</span> method <span class="token operator">===</span> <span class="token string">&#39;put&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data <span class="token operator">=</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 实际的请求方法</span>
    <span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token punctuation">,</span>
      method<span class="token punctuation">,</span>
      <span class="token operator">...</span>data
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">/* console.info(response) */</span>
      <span class="token keyword">const</span> res_data<span class="token operator">:</span> IResponse <span class="token operator">=</span> response
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res_data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res_data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token operator">:</span> AxiosError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>XRequest 方法其实就是我们最后封装导出的请求函数，可以看到它内部是对我们传入参数进行了处理，如果是 get 方法.....，如果是 post方法 ....， 如果需要 token 验证......。所以我们可以通过传递不同的参数控制最后请求的行为来达到不同的目的。内部的 http 其实就是我们刚刚创建的 axios 实例，每次请求其实都是用 axios 实例去请求。</li></ul><blockquote><p>❗ 里面有一个可优化的点，我们每次导入 http 的时候，都得去创建一个 axios 实例，那其实带来的是资源的浪费，因为其实都是一个 axios 嘛，那我们可不可以判断 axios 是否创建了，创建了就直接复用原来的就好了，这是一个可以考虑去优化的点（设计模式中的单例模式）</p></blockquote><p>上面的配置其实都是根据不同的项目动态变化的，比如对于我们当前的项目来说，需要我们传递的 Content-Type 是 mutipart/form-data 也就是 form-data 数据。</p><div class="language-js"><pre><code><span class="token comment">// 那我就加入这个判断 -- 判断是否是需要我们传递 form-data 类型的数据  </span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token operator">?.</span>isFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> contentType <span class="token operator">=</span> headers <span class="token operator">&amp;&amp;</span> headers<span class="token punctuation">[</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">]</span>
      <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">in</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 添加参数进 入 formData 中</span>
        formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> param<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> formData <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="storage" tabindex="-1">storage <a class="header-anchor" href="#storage" aria-hidden="true">#</a></h3><blockquote><p>localStorage 缓存身份验证码</p></blockquote><div class="language-ts"><pre><code><span class="token keyword">type</span> <span class="token class-name">StorageItem</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  lastTime<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @class 本地localStorage 封装
 */</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LocalStorge</span> <span class="token punctuation">{</span>
  limit <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token comment">// 一天</span>

  <span class="token comment">/* 获得缓存内容 */</span>
  <span class="token function">getLocalItem</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nowTime <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> keyword <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>keyword <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 不存在 content */</span>
      <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span> <span class="token keyword">as</span> StorageItem
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nowTime <span class="token operator">-</span> item<span class="token operator">?.</span>lastTime <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>limit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* content 过期 */</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">deleteLocalItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> item<span class="token punctuation">.</span>content
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* 设置缓存内容 */</span>
  <span class="token function">setLocalItem</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> item<span class="token operator">:</span> StorageItem <span class="token operator">=</span> <span class="token punctuation">{</span>
      content<span class="token operator">:</span> content<span class="token punctuation">,</span>
      lastTime<span class="token operator">:</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>
      key<span class="token punctuation">,</span>
      <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* 删除缓存内容 */</span>
  <span class="token function">deleteLocalItem</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>localStorage 是持久性的存储，持久性指的是如果不手动去清除的话它就一直都在，这其实是不好的，因此有必要设定一个有效期来判断一个存储内容块的合法性。</p></blockquote><p>上面的逻辑主要是在 setLocalItem 的时候，将 content 和 lastTime 打包一起存进去，lastTime 指的是存进入的时间，然后在 getItem 的时候用当前时间 - 上次存进去的时间(nowTime - lastTime)的值与 limit (有效时间范围) 进行对比，如果在这个范围内的话，那么我们就认为这个缓存是有效的，否则就提示用户缓存过期然后清除掉当前的缓存(重置的过程)。</p><p>😄 其实记住密码我觉得也是这么做的，最简单的就是点击记住密码以后存入缓存，每次到登录页的时候去看看缓存有没有用户名和密码，当然这样很不安全，因为密码是可以在开发者工具被人看到的。(配合后台实现的方法更优：缓存记住密码这个布尔值，自动请求接口)</p><h3 id="usepage" tabindex="-1">usePage <a class="header-anchor" href="#usepage" aria-hidden="true">#</a></h3><blockquote><p>封装路由跳转函数</p></blockquote><ul><li><a href="https://router.vuejs.org/zh/api/#routelocationraw" target="_blank" rel="noopener noreferrer">vue-router RouteLocationRaw 介绍</a></li></ul><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteLocationRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PageEnum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/enum/pageEnum&#39;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;../router&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">RouteLocationRawEx</span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>RouteLocationRaw<span class="token punctuation">,</span> <span class="token string">&#39;path&#39;</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span> path<span class="token operator">:</span> PageEnum <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @function 自定义Vue-Router导航函数
 * @returns {Function} go
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useGo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Function</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> push<span class="token punctuation">,</span> replace <span class="token punctuation">}</span> <span class="token operator">=</span> router
  <span class="token keyword">function</span> <span class="token function">go</span> <span class="token punctuation">(</span>opt <span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> RouteLocationRawEx<span class="token punctuation">,</span> isReplace <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> opt <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isReplace <span class="token operator">?</span> <span class="token function">replace</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">push</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>	
      <span class="token keyword">const</span> o <span class="token operator">=</span> opt <span class="token keyword">as</span> RouteLocationRaw
      isReplace <span class="token operator">?</span> <span class="token function">replace</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">push</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> go
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useBack</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> back <span class="token punctuation">}</span> <span class="token operator">=</span> router
  <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Vue-Router 的路由跳转的方法其实有两种</p><ol><li>push 保留历史记录</li><li>replace 不保留历史记录</li></ol><p>push：</p><div class="language-js"><pre><code><span class="token comment">// 正常我们路由跳转的方式</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/home/overview&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 方式一：传递 path 字符串</span>
router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Home&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 方式二：传递一个路由项对象</span>
</code></pre></div><p>上面的 opt 其实做了一个这样子的判断，根据不同类型的 opt 就以不同的写法/方式去跳转.</p><ul><li>不同策略传递的结果</li></ul><div class="language-js"><pre><code><span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/test&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;yes&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// http://localhost:3000?name=yes</span>
<span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Test&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;yes&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// http://localhost:3000/yes</span>
</code></pre></div><h3 id="usecurrentinstance" tabindex="-1">useCurrentInstance <a class="header-anchor" href="#usecurrentinstance" aria-hidden="true">#</a></h3><blockquote><p>获得根实例，从而拿到诸如全局变量等信息</p></blockquote><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useCurrentInstance</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> appContext <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ComponentInternalInstance
  <span class="token keyword">const</span> proxy <span class="token operator">=</span> appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    proxy
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>函数的作用是获取全局挂载的属性或者方法</p></blockquote><p>因为我们也知道在 vue3 其实是移除了原型这个概念，所以没办法像以前一样将一些东西挂载到原型上</p><div class="language-js"><pre><code>app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>xxx <span class="token operator">=</span> xxx <span class="token comment">//  新的方式</span>
</code></pre></div><p>❓ 那怎么在组件中获取这些变量呢</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> proxy <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
proxy<span class="token punctuation">.</span>xxx <span class="token comment">// 就可以访问了</span>
</code></pre></div><h3 id="useecharts" tabindex="-1">useEcharts <a class="header-anchor" href="#useecharts" aria-hidden="true">#</a></h3><div class="language-typescript"><pre><code><span class="token comment">// src/utils/useEcharts </span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  TitleComponent<span class="token punctuation">,</span>
  TooltipComponent<span class="token punctuation">,</span>
  LegendComponent
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;echarts/components&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PieChart <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;echarts/charts&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LabelLayout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;echarts/features&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CanvasRenderer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;echarts/renderers&#39;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> echarts <span class="token keyword">from</span> <span class="token string">&#39;echarts/core&#39;</span>

echarts<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  TitleComponent<span class="token punctuation">,</span>
  TooltipComponent<span class="token punctuation">,</span>
  LegendComponent<span class="token punctuation">,</span>
  PieChart<span class="token punctuation">,</span>
  CanvasRenderer<span class="token punctuation">,</span>
  LabelLayout
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> echarts
</code></pre></div><p>❓ 为什么要把 echarts 抽取出来呢？因为我们需要按需引入 echarts 内部的组件，比如我们当前用到了饼图，直方图，折线图，那么我们就需要引用里面的组件，如果在不同地方引入的话其实相对来说还是挺麻烦的，倒不如我们整个 echarts 实例放到一个文件里面，在这个文件内引入需要的组件然后导出那么不就各个地方都可以使用了！！！</p><h2 id="跨域问题" tabindex="-1">跨域问题 <a class="header-anchor" href="#跨域问题" aria-hidden="true">#</a></h2><ul><li>浏览器限制不同协议，域名，端口的主机之间进行通信，由此产生了跨域。那么跨域导致的结果是什么？</li></ul><p><img src="/yunshan-qingyu-docs/migration.png" alt=""></p><p>图片的意思就是说当我们访问 <a href="http://120.77.245.193/blog-system" target="_blank" rel="noopener noreferrer">http://120.77.245.193/blog-system</a>.... 这个资源路径的时候，被限制了，其实这个限制是浏览器的限制，它提示我们可以使用 CORS(跨域资源共享) 来解决</p><h3 id="后台处理-反向代理" tabindex="-1">后台处理(反向代理) <a class="header-anchor" href="#后台处理-反向代理" aria-hidden="true">#</a></h3><ol><li>改变 apache / nginx 的配置文件支持 CORS</li><li>后台返回的时候加上对应的返回标头给浏览器</li></ol><h3 id="前端处理-正向代理" tabindex="-1">前端处理(正向代理) <a class="header-anchor" href="#前端处理-正向代理" aria-hidden="true">#</a></h3><ol><li><p>通过脚手架虚拟一个代码服务器</p><div class="language-js"><pre><code><span class="token comment">// vite.config.ts 添加    </span>
<span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#39;^/api/.*&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;http://120.25.158.199:8001&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token function-variable function">rewrite</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>然后在我们写请求接口的时候，默认使用 /api 前缀，项目启动的时候，本地服务器会拦截到我们的网络请求并将请求转接到代理服务器上，代理服务器通过不断的 ip 寻址找到我们需要请求的远程服务器，然后帮我们发送请求接受请求。</p></li></ol><h2 id="开发环境-mock" tabindex="-1">开发环境 mock <a class="header-anchor" href="#开发环境-mock" aria-hidden="true">#</a></h2><p>插件：<code>vite-plugin-mock</code></p><p>vite-plugin-mock 其实是一个在 vite 中集成 mock 的插件。传统的 mock 其实需要在每个地方把 mock 方法导入注册一遍，工序较为烦琐，而 vite-plugin-mock 作为一个脚手架层级支持的插件，使用上无论是在开发还是生产阶段都十分便捷。</p><ul><li>内部以特定的结构组成，但 mock 的语法与 mockjs 一致。</li></ul><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MockMethod <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-mock&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">&#39;/api/get/analyses&#39;</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span>
    <span class="token function">response</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#39;data|50&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          id<span class="token operator">:</span> <span class="token string">&#39;@integer(1, 100)&#39;</span><span class="token punctuation">,</span>
          keyword<span class="token operator">:</span> <span class="token string">&#39;@csentence(5, 10)&#39;</span><span class="token punctuation">,</span>
          startTime<span class="token operator">:</span> <span class="token string">&#39;@date&#39;</span><span class="token punctuation">,</span>
          endTime<span class="token operator">:</span> <span class="token string">&#39;@date&#39;</span><span class="token punctuation">,</span>
          nowTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;-&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span> <span class="token keyword">as</span> MockMethod<span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre></div><p>项目开发初期没有后台介入数据无法正常显示，基于插件的特性，配置 mock 拦截在生产环境生效。在 <code>vite.config.ts</code> 增加插件配置，配置的关键在于是否开启生产环境的 mock，如果开启了，那么就会在生产阶段执行 injectCode 里面的代码。</p><div class="language-tsx"><pre><code><span class="token function">viteMockServe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   ignore<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\_</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    mockPath<span class="token operator">:</span> <span class="token string">&#39;mock&#39;</span><span class="token punctuation">,</span> <span class="token comment">// mock 地址</span>
    localEnabled<span class="token operator">:</span> localEnable<span class="token punctuation">,</span> <span class="token comment">// 开发环境是否开启 mock</span>
    prodEnabled<span class="token operator">:</span> productEnable<span class="token punctuation">,</span> <span class="token comment">// 生产环境是否开启 mock</span>
    supportTs<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 监听 .ts 文件(与此带来的后果是无法监听 .js 文件)</span>
    injectCode<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
       import { setupProdMockServer } from &#39;../mock/_setupMockProdServer&#39;;
        setupProdMockServer();
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-tsx"><pre><code><span class="token comment">// mock/_setupMockProdServer.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createProdMockServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-mock/es/createProdMockServer&#39;</span>

<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">globEager</span><span class="token punctuation">(</span><span class="token string">&#39;./**/*.ts&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mockModules<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">// 加载 &amp; 排除模块</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;/_&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">}</span>
  mockModules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>modules<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span>default<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupProdMockServer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">createProdMockServer</span><span class="token punctuation">(</span>mockModules<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>_setupMockProdServer</code> 其实是利用了 vite 提供检索文件的 api，检索 mock 文件夹内的所有文件，然后通过 <code>createProdMockServer</code> 注册 mock 列表，完成在生产环境的应用。</p><h2 id="应用部署" tabindex="-1">应用部署 <a class="header-anchor" href="#应用部署" aria-hidden="true">#</a></h2><p>由于路由模式使用的是 history 模式，因此回退或者刷新页面难免会出现找不到资源路径的情况，而当时刷新页面的时候 <code>/yunshan-qingyu/home/overview</code> 浏览器会向服务器请求这个资源，但是服务器内其实并没有这个资源路径，因为对应来说在 Vue 应用里面我们是使用 JS 来进行路由导航的，渲染页面的过程为内部处理，这也是 SPA 的特性。</p><blockquote><p>构建结束会把 <code>main.ts</code> 里面的内容合并为一个 chunk 包在 html 中进行引入，</p></blockquote><div class="language-html"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>referrer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>no-referrer<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/yunshan-qingyu/favicon.ico<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>云山晴雨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/yunshan-qingyu/assets/index.210becc0.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modulepreload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/yunshan-qingyu/assets/vendor.9d0a82a1.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/yunshan-qingyu/assets/vendor.82c3829d.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/yunshan-qingyu/assets/index.bfce105e.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>解决的方法其实就是我们去修改 http 服务器的配置文件对当前无法匹配的路径进行重定向。</p></div><p>对于 apache 服务器，新建一个 .htaccess 文件在服务根目录下(可以到 http.conf 查看当前挂载的根目录在哪)，然后使用 IfModule 来重写定向规则。大概的思路就是指定一个 base，指定一个重定向终点文件 <code>index.html</code></p><div class="language-"><pre><code>&lt;IfModule mod_rewrite.c&gt;
RewriteEngine On
RewriteBase /
RewriteRule ^index\.html$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.html [L]
&lt;/IfModule&gt;
</code></pre></div><h2 id="功能亮点" tabindex="-1">功能亮点 <a class="header-anchor" href="#功能亮点" aria-hidden="true">#</a></h2><h3 id="输入框级联" tabindex="-1">输入框级联 <a class="header-anchor" href="#输入框级联" aria-hidden="true">#</a></h3><p>？？？</p><h2 id="补充知识" tabindex="-1">补充知识 <a class="header-anchor" href="#补充知识" aria-hidden="true">#</a></h2><h3 id="object-的序列化" tabindex="-1">Object 的序列化 <a class="header-anchor" href="#object-的序列化" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;wyl&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出的是 [object Object]</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;wyl&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&#39;wyl&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出的是 wyl</span>
</code></pre></div><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/20/16de9512eaf1158a~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt=""></p><p>对象转为原始类型</p><ul><li>如果<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toPrimitive" target="_blank" rel="noopener noreferrer">Symbol.toPrimitive</a>方法，优先调用再返回</li></ul><blockquote><p>valueOf 和 toString 的优先级随着转换类型的不同而不同</p></blockquote><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/valueOf" target="_blank" rel="noopener noreferrer">valueOf()</a>，如果转换为原始类型，则返回</li><li>toString()，如果转换为原始类型，则返回</li><li>如果都没有返回原始类型，会报错</li></ul><div class="language-js"><pre><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;wyl&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">hint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// hint 就是当前需要转化的类型</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>hint <span class="token operator">===</span> <span class="token string">&#39;number&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 如果当前需要转化的是 number</span>
            <span class="token keyword">return</span> <span class="token number">10</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>hint <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果当前需要转化的是string</span>
            <span class="token keyword">return</span> <span class="token string">&#39;wyl&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&#39;10&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>a<span class="token punctuation">)</span> <span class="token comment">// 10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// wyl</span>
</code></pre></div><p>针对上面的输出结果，我们可以看到 Symbol.toPrimitive 的优先级是最高的，无论是字符串还是数值，都会优先调用。而对于 valueOf 和 toString。</p><ul><li>如果是转化为字符串的话，则优先调用 toString</li><li>如果是转化为数值的话，则优先调用 valueOf</li><li>具体的效果可以 通过把 Symbol.toPrimitive 注释掉看看</li></ul><h3 id="类型判断" tabindex="-1">类型判断 <a class="header-anchor" href="#类型判断" aria-hidden="true">#</a></h3><h4 id="instanceof" tabindex="-1"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof" target="_blank" rel="noopener noreferrer">instanceof</a> <a class="header-anchor" href="#instanceof" aria-hidden="true">#</a></h4><blockquote><p>判断一个变量是否是另一个变量的原型</p></blockquote><h4 id="typeof" tabindex="-1"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof" target="_blank" rel="noopener noreferrer">typeof</a> <a class="header-anchor" href="#typeof" aria-hidden="true">#</a></h4><blockquote><p>判断基础类型</p></blockquote><h4 id="object-prototype-tostring" tabindex="-1"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString" target="_blank" rel="noopener noreferrer">Object.prototype.toString</a> <a class="header-anchor" href="#object-prototype-tostring" aria-hidden="true">#</a></h4><blockquote><p>精确判断变量的类型</p></blockquote><div class="language-js"><pre><code><span class="token comment">// Boolean 类型，tag 为 &quot;Boolean&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// =&gt; &quot;[object Boolean]&quot;</span>

<span class="token comment">// Number 类型，tag 为 &quot;Number&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// =&gt; &quot;[object Boolean]&quot;</span>

<span class="token comment">// String 类型，tag 为 &quot;String&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// =&gt; &quot;[object String]&quot;</span>

<span class="token comment">// Array 类型，tag 为 &quot;String&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// =&gt; &quot;[object Array]&quot;</span>

<span class="token comment">// Function 类型， tag 为 &quot;Function&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// =&gt; &quot;[object Function]&quot;</span>

<span class="token comment">// Error 类型（包含子类型），tag 为 &quot;Error&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// =&gt; &quot;[object Error]&quot;</span>

<span class="token comment">// RegExp 类型，tag 为 &quot;RegExp&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// =&gt; &quot;[object RegExp]&quot;</span>

<span class="token comment">// Date 类型，tag 为 &quot;Date&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; &quot;[object Date]&quot;</span>

<span class="token comment">// 其他类型，tag 为 &quot;Object&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// =&gt; &quot;[object Object]&quot;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// 总结一下我们可以抽取一个精确判断变量类型的方法</span>
<span class="token keyword">function</span> <span class="token function">toRawType</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toRawType</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Array</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toRawType</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Object</span>
</code></pre></div><p>fighting fighting !!!! <img src="/yunshan-qingyu-docs/cute.jpg" alt=""></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"9d8a7904\",\"learning_index.md\":\"f620b335\"}")</script>
    <script type="module" async src="/yunshan-qingyu-docs/assets/app.2f45899f.js"></script>
    
  </body>
</html>